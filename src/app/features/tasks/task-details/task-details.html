<div class="task-details-container">
  @if (isFetching) {
  <div class="page-loader">
    <i class="fas fa-spinner fa-spin"></i>
    <p>Loading task details...</p>
  </div>
  } @else if (taskNotFound) {
  <div class="error-state">
    <i class="fas fa-exclamation-triangle"></i>
    <h3>Task Not Found</h3>
    <p>The task you are looking for does not exist or has been deleted.</p>
    <button routerLink="/dashboard" class="cancel-btn">Back to Dashboard</button>
  </div>
  } @else {
  <h2>{{ isEditMode ? 'Edit Task' : 'Add New Task' }}</h2>

  <form (ngSubmit)="saveTask()" #taskForm="ngForm">
    <input type="text" name="title" [(ngModel)]="task.title" placeholder="Title" required />

    <textarea
      name="description"
      [(ngModel)]="task.description"
      placeholder="Description"
    ></textarea>

    <select name="status" [(ngModel)]="task.status">
      <option value="pending">Pending</option>
      <option value="in_progress">In Progress</option>
      <option value="completed">Completed</option>
    </select>

    <div class="attachment-section">
      @if (task.attachment) {
      <div class="existing-attachment">
        <button
          type="button"
          (click)="onDownload()"
          class="download-link-btn"
          [disabled]="isDownloading"
        >
          <i class="fas {{ isDownloading ? 'fa-spinner fa-spin' : 'fa-download' }}"></i>
          {{ isDownloading ? 'Downloading...' : 'Download current attachment' }}
        </button>
      </div>
      }

      <div class="file-input-container">
        <label for="attachment">
          <i class="fas fa-paperclip"></i>
          {{ task.attachment ? 'Change attachment' : 'Add attachment' }}
        </label>
        <input type="file" id="attachment" (change)="onFileSelected($event)" />
        @if (selectedFileName) {
        <span class="file-name">{{ selectedFileName }}</span>
        }
      </div>
    </div>

    <div class="actions">
      <button type="submit" [disabled]="!taskForm.valid || isLoading || isDeleting">
        @if (isLoading) { <i class="fas fa-spinner fa-spin"></i> Saving... } @else {
        <i class="fas {{ isEditMode ? 'fa-save' : 'fa-plus' }}"></i>
        {{ isEditMode ? 'Save changes' : 'Create' }} }
      </button>

      @if (isEditMode) {
      <button
        type="button"
        class="delete-btn"
        (click)="onDelete()"
        [disabled]="isLoading || isDeleting"
      >
        @if (isDeleting) { <i class="fas fa-spinner fa-spin"></i> Deleting... } @else {
        <i class="fas fa-trash"></i> Delete }
      </button>
      }

      <button type="button" routerLink="/dashboard" class="cancel-btn">
        <i class="fas fa-times"></i> Cancel
      </button>
    </div>
  </form>
  }
</div>
